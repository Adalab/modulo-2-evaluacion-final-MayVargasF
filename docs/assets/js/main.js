"use strict";function getDataApi(e="",n=1){fetch(`https://api.jikan.moe/v4/anime?q=${e}&page=${n}`).then(e=>e.json()).then(e=>{animes=e.data,pagination=e.pagination,0===animes.length?noResult.innerHTML="Lo sentimos, no hay resultados. Inténtalo de nuevo con otra serie.":noResult.innerHTML="",renderAnimes(animes,listAnime),pageInfo()})}getDataApi();const listAnime=document.querySelector(".js_list_anime");let animes=[];function listenerFavorites(){const e=document.querySelectorAll(".js_remove");for(const n of e)n.addEventListener("click",handleClickRemoveSelected)}function listenerAnimes(){const e=document.querySelectorAll(".js_eachAnime");for(const n of e)n.addEventListener("click",handleClickFav)}function renderAnimes(e,n){let t="",a="",i="js_eachAnime";for(const s of e){a=-1!==favorites.findIndex(e=>s.mal_id===e.mal_id)&&n.classList.contains("js_list_anime")?"animeList--favorite":"",i=n.classList.contains("js_list_anime")?"js_eachAnime":"",t+=`<li class="${i} ${a}" id="${s.mal_id}">`,t+='<div class="anime-container">',t+=`<div class="removecont"><h3>${s.title}</h3>`,n.classList.contains("js_fav_list")&&(t+='<i class="fa-solid fa-circle-xmark js_remove"></i>'),t+=`</div><img src=${imagePlaceholder(s)} alt="${s.title} cover"/>`,t+="</div></li>"}n.innerHTML=t,listenerFavorites(),listenerAnimes()}function render(){renderAnimes(favorites,favList),renderAnimes(animes,listAnime)}function imagePlaceholder(e){return"https://cdn.myanimelist.net/img/sp/icon/apple-touch-icon-256.png"===e.images.jpg.image_url?"https://via.placeholder.com/210x295/ffffff/666666/?text=TV":e.images.jpg.image_url}const favList=document.querySelector(".js_fav_list"),deleteFav=document.querySelector(".js-deleteFav"),favMsg=document.querySelector(".js_noFavorites");let favorites=[];function handleClickFav(e){const n=e.currentTarget.id,t=animes.find(e=>e.mal_id.toString()===n.toString()),a=favorites.findIndex(e=>e.mal_id.toString()===n.toString());-1===a?favorites.push(t):favorites.splice(a,1),localStorage.setItem("favData",JSON.stringify(favorites)),render(),favInfo()}function handleClickDelete(){localStorage.removeItem("favData"),favorites=[],render(),favInfo()}function handleClickRemoveSelected(e){const n=e.srcElement.parentElement.parentElement.parentElement.id,t=favorites.findIndex(e=>e.mal_id.toString()===n.toString());favorites.splice(t,1),render(),favInfo()}function favInfo(){0===favorites.length?favMsg.innerHTML="Todavía no tienes ninguna serie favorita. Haz click sobre tus series favoritas para empezar a guardarlas.":favMsg.innerHTML=""}function favStorage(){const e=JSON.parse(localStorage.getItem("favData"));e?(favorites=e,renderAnimes(favorites,favList)):favList.innerHTML="",favInfo()}deleteFav.addEventListener("click",handleClickDelete),favStorage();let pagination={};const previousBtn=document.querySelector(".js_previousBtn"),nextBtn=document.querySelector(".js_nextBtn"),paginationMsg=document.querySelector(".js_pagination");function pageInfo(){paginationMsg.innerHTML=`${pagination.current_page} de ${pagination.last_visible_page}`}function handleClickPrevious(){getDataApi(searchInput.value.toLowerCase(),parseInt(pagination.current_page)-1),pageInfo(),window.scrollTo(0,0)}function handleClickNext(){getDataApi(searchInput.value.toLowerCase(),pagination.has_next_page?pagination.current_page+1:pagination.current_page),pageInfo(),window.scrollTo(0,0)}previousBtn.addEventListener("click",handleClickPrevious),nextBtn.addEventListener("click",handleClickNext);const searchBtn=document.querySelector(".js_searchBtn"),searchInput=document.querySelector(".js_searchInput"),noResult=document.querySelector(".js_noResults"),handleClickSearch=e=>{e.preventDefault();getDataApi(searchInput.value.toLowerCase()),pageInfo()};searchBtn.addEventListener("click",handleClickSearch);const resetBtn=document.querySelector(".js_resetBtn");function handleClickReset(e){e.preventDefault(),searchInput.value="",getDataApi(),noResult.innerHTML="",window.scrollTo(0,0)}resetBtn.addEventListener("click",handleClickReset);